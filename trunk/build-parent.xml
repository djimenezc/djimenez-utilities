<?xml version="1.0" encoding="UTF-8"?>

<project name="djimenez-utilities-parent" basedir=".">

	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
		<classpath>
			<pathelement location="${ant-contrib.file}" />
		</classpath>
	</taskdef>

	<taskdef resource="net/sf/antcontrib/antlib.xml">
		<classpath>
			<pathelement location="${ant-contrib.file}" />
		</classpath>
	</taskdef>

	<property name="parent.dir" value="${basedir}" />
	<property name="scripts.dir" value="${parent.dir}/scripts" />

	<property file="build.${user.name}.properties" />
	<property environment="env" />

	<property name="local.sql.user" value="root" />
	<property name="local.sql.pass" value="root" />
	<property name="local.sql.driver" value="com.mysql.jdbc.Driver" />
	<property name="local.sql.url" value="jdbc:mysql://localhost:3306/" />

	<property name="log.dir" value="/tmp" />
	<property name="src.dir" value="${basedir}" />
	<property name="compile.dir" value="${basedir}" />
	<property name="bbdd.dir"
		value="${parent.dir}/schema/src/main/resources/common/schemas"></property>

	<target name="clean-log" depends="" description="">

		<delete>
			<fileset dir="${log.dir}" includes="compile-error.log" />
			<fileset dir="${log.dir}" includes="compile.log" />
		</delete>

	</target>

	<target name="-maven-projects">
		<for list="${projects}" param="project">
			<sequential>
				<antcall target="-maven">
					<param name="project" value="@{project}" />
					<param name="tasks" value="${tasks}" />
				</antcall>
			</sequential>
		</for>
	</target>

	<target name="-maven">
		<echo>Maven tasks: ${tasks} </echo>
		<echo>Folder: ${project}</echo>

		<exec executable="${scripts.dir}/mvn.sh" failonerror="true">
			<arg value="${compile.dir}" />
			<arg value="${tasks}" />
			<arg value="${log.dir}" />
			<arg value="${project}" />
			<env key="PATH" path="${env.PATH}:${maven.home}/bin" />
		</exec>
	</target>

	<target name="sonar" depends="" description="">

		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Analyze:
			${start.timestamp}
			Projects: ${compile.projects}
			------------------------------------------
		    </echo>

		<antcall target="-maven-projects">
			<param name="projects" value="${compile.projects}" />
			<param name="tasks" value="sonar:sonar" />
		</antcall>
	</target>

	<target name="clean-all" depends="" description="">

		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Clean spring-mvc :
			${start.timestamp}
			------------------------------------------
		    </echo>

		<antcall target="-maven-projects">
			<param name="projects" value="${compile.projects}" />
			<param name="tasks" value="clean" />
		</antcall>
	</target>

	<target name="compile-all" depends="" description="">

		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Compile:
			${start.timestamp}
			------------------------------------------
		    </echo>

		<antcall target="-maven-projects">
			<param name="projects" value="${compile.projects}" />
			<param name="tasks" value="install" />
		</antcall>
	</target>

	<target name="compile-all-quick" depends="" description="">

		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Compile quickly:
			${start.timestamp}
			------------------------------------------
		    </echo>

		<antcall target="-maven-projects">
			<param name="projects" value="${compile.projects}" />
			<param name="tasks" value="install,-Dmaven.test.skip=true" />
		</antcall>
	</target>
	
	<target name="prepare-release" depends="" description="">

		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Generating release:
			${start.timestamp}
			------------------------------------------
		    </echo>

		<antcall target="-maven-projects">
			<param name="projects" value="${compile.projects}" />
			<param name="tasks" value="release:prepare" />
		</antcall>
	</target>

	<target name="deploy-release-repository" depends="" description="">

		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Deploy release in repotitory:
			${start.timestamp}
			------------------------------------------
		    </echo>

		<antcall target="-maven-projects">
			<param name="projects" value="${compile.projects}" />
			<param name="tasks" value="deploy" />
		</antcall>
	</target>

	<target name="last-operation-summary" depends=""
		description="Load the frontoffice data in local">
		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Last operation
			summary: ${start.timestamp}
			Ip: Localhost
			Projects: ${compile.projects}
			PATH= ${env.PATH}:${maven.home}/bin
			------------------------------------------
			
			</echo>

		<exec executable="${scripts.dir}/mvnsummary.sh">
			<arg value="${compile.dir}" />
			<arg value="${compile.projects}" />
			<arg value="${log.dir}" />
			<env key="PATH" path="${env.PATH}" />
		</exec>

	</target>

	<target name="-database">
		<tstamp>
			<format property="start.timestamp" pattern="dd-MMM-yy HH:mm:ss" />
		</tstamp>

		<echo>
			------------------------------------------
			Database Clean :
			${start.timestamp}
			Ip: Localhost
			------------------------------------------
		
			</echo>

		<sql driver="${local.sql.driver}" url="${local.sql.url}" userid="${local.sql.user}"
			password="${local.sql.pass}">
			<transaction src="${bbdd.dir}/${sql.file}" />
		</sql>

	</target>


</project>